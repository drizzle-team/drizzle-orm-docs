import CodeTab from "@/components/markdown/CodeTab.astro";
import CodeTabs from "@/components/markdown/CodeTabs.astro";
import Section from "@/components/markdown/Section.astro";
import Tab from "@/components/markdown/Tab.astro";
import Tabs from "@/components/markdown/Tabs.astro";
import Callout from "@mdx/Callout.astro";
import Prerequisites from "@mdx/Prerequisites.astro";
import Npx from "@mdx/Npx.astro";

# `drizzle-kit migrate`
<Prerequisites>
- Get started with Drizzle and `drizzle-kit` - [read here](/docs/get-started)
- Drizzle schema foundamentals - [read here](/docs/sql-schema-declaration)
- Database connection basics - [read here](/docs/connect-overview)
- Drizzle migrations foundamentals - [read here](/docs/migrations)
- Drizzle Kit [overview](/docs/kit-overview) and [config file](/docs/drizzle-config-file)
- `drizzle-kit generate` command - [read here](/docs/drizzle-kit-generate)
</Prerequisites>
<br/>


`drizzle-kit migrate` lets you apply SQL migrations generated by [`drizzle-kit generate`](/docs/drizzle-kit-generate). 
It's designed to cover [code first(option 3)](/docs/migrations) approach of managing Drizzle migrations. 

<CodeTabs items={["drizzle.config.ts", "CLI options"]}>
<Section>
```shell
npx drizzle-kit migrate
```
```ts
// drizzle.config.ts
import { defineConfig } from "drizzle-kit";

export default defineConfig({
  dialect: "postgresql",
  schema: "./src/schema.ts",
});
```
</Section>
```shell
npx drizzle-kit migrate --dialect=postgresql --schema=./src/schema.ts
```
</CodeTabs>

You can have multiple config files in the project, it's very useful when you have multiple database stages or multiple databases or different databases on the same project:
<Npx>
  drizzle-kit migrate --config=drizzle-dev.config.ts
  drizzle-kit migrate --config=drizzle-prod.config.ts
</Npx>
```plaintext {5-6}
ðŸ“¦ <project root>
 â”œ ðŸ“‚ drizzle
 â”œ ðŸ“‚ src
 â”œ ðŸ“œ .env
 â”œ ðŸ“œ drizzle-dev.config.ts
 â”œ ðŸ“œ drizzle-prod.config.ts
 â”œ ðŸ“œ package.json
 â”” ðŸ“œ tsconfig.json
```
#### Under the hood
<Section>
```plaintext
  â”œ ðŸ“‚ drizzle       
  â”‚ â”œ ðŸ“‚ 20242409125510_premium_mister_fear
  â”‚ â”‚ â”œ ðŸ“œ snapshot.json
  â”‚ â”‚ â”” ðŸ“œ migration.sql  <--- migration file
  â”‚ â”” ðŸ“‚ 20242409135510_delicate_professor_xavie
  â”‚   â”œ ðŸ“œ snapshot.json
  â”‚   â”” ðŸ“œ migration.sql  <--- migration file
  â”” â€¦
```
```plaintext
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                  
â”‚ $ drizzle-kit migrate â”‚                  
â””â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                  
  â”‚                                                         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                         
  â”” 1. reads migration.sql files in migrations folder       â”‚                          â”‚
    2. fetch migration history from database -------------> â”‚                          â”‚
  â”Œ 3. pick previously unapplied migrations <-------------- â”‚         DATABASE         â”‚
  â”” 4. apply new migration to the database ---------------> â”‚                          â”‚
                                                            â”‚                          â”‚
                                                            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
[âœ“] done!        
```
</Section>