import { Tab, Tabs } from 'nextra-theme-docs';

# SQL schema declaration

You declare SQL schema in TypeScript in either one `schema.ts` file
or you can group them logically in multiple logically grouped files, whichever you prefer, all the freedom!

```plaintext
ðŸ“¦ <project root>
 â”” ðŸ“‚ src
    â”” ðŸ“‚ db
       â”” ðŸ“œ schema.ts
```

```plaintext
ðŸ“¦ <project root>
 â”” ðŸ“‚ src
    â”” ðŸ“‚ db
       â”” ðŸ“‚ schema
          â”œ ðŸ“œ users.ts
          â”œ ðŸ“œ countries.ts
          â”œ ðŸ“œ cities.ts
          â”œ ðŸ“œ products.ts
          â”œ ðŸ“œ clients.ts
          â”œ ðŸ“œ enums.ts
          â”” ðŸ“œ etc.ts
```

```plaintext
ðŸ“¦ <project root>
 â”” ðŸ“‚ src
    â”œ ðŸ“‚ get-user
    â”‚  â”œ ðŸ“œ user.ts
    â”‚  â”” ðŸ“œ handler.ts
    â”œ ðŸ“‚ get-city
    â”‚  â”œ ðŸ“œ city.ts
    â”‚  â”” ðŸ“œ handler.ts
    â”œ  ...
```

You can declare tables, indexes and constraints, foreign keys and enums.  
Please pay attention to `export` keyword, they are mandatory if you'll be using [drizzle-kit SQL migrations generator](#migrations)

<Tabs items={['PostgreSQL', 'MySQL', 'SQLite']}>
  <Tab>
  ```typescript copy
  import { pgEnum, pgTable, serial, uniqueIndex, varchar } from 'drizzle-orm/pg-core';

  // declaring enum in database
  export const popularityEnum = pgEnum('popularity', ['unknown', 'known', 'popular']);

  export const countries = pgTable('countries', {
    id: serial('id').primaryKey(),
    name: varchar('name', { length: 256 }),
  }, (countries) => {
    return {
      nameIndex: uniqueIndex('name_idx').on(countries.name),
    }
  });

  export const cities = pgTable('cities', {
    id: serial('id').primaryKey(),
    name: varchar('name', { length: 256 }),
    countryId: integer('country_id').references(() => countries.id),
    popularity: popularityEnum('popularity'),
  });
  ```

  Database and table explicit entity types:
  ```typescript copy
  import type { InferModel } from 'drizzle-orm';
  import { pgTable, serial, text, varchar } from 'drizzle-orm/pg-core';
  import { drizzle, NodePgDatabase } from 'drizzle-orm/node-postgres';

  const users = pgTable('users', {
    id: serial('id').primaryKey(),
    fullName: text('full_name'),
    phone: varchar('phone', { length: 256 }),
  });

  export type User = InferModel<typeof users>; // return type when queried
  export type NewUser = InferModel<typeof users, 'insert'>; // insert type
  // ...

  const db: NodePgDatabase = drizzle(...);

  const result: User[] = await db.select().from(users);

  export async function insertUser(user: NewUser): Promise<User> {
    return db.insert(users).values(user).returning();
  }
  ```
  </Tab>
  <Tab>
  ```typescript copy
  import { int, mysqlEnum, mysqlTable, serial, uniqueIndex, varchar } from 'drizzle-orm/mysql-core';

  // declaring enum in database
  export const countries = mysqlTable('countries', {
    id: serial('id').primaryKey(),
    name: varchar('name', { length: 256 }),
  }, (countries) => ({
    nameIndex: uniqueIndex('name_idx').on(countries.name),
  }));

  export const cities = mysqlTable('cities', {
    id: serial('id').primaryKey(),
    name: varchar('name', { length: 256 }),
    countryId: int('country_id').references(() => countries.id),
    popularity: mysqlEnum('popularity', ['unknown', 'known', 'popular']),
  });
  ```

  Database and table explicit entity types:  
  ```typescript copy
  import type { InferModel } from 'drizzle-orm';
  import { mysqlTable, serial, text, varchar } from 'drizzle-orm/mysql-core';
  import type { MySqlRawQueryResult } from 'drizzle-orm/mysql2';
  import { drizzle } from 'drizzle-orm/mysql2';
  import mysql from 'mysql2/promise';

  const users = mysqlTable('users', {
    id: serial('id').primaryKey(),
    fullName: text('full_name'),
    phone: varchar('phone', { length: 256 }),
  });

  export type User = InferModel<typeof users>; // return type when queried
  export type NewUser = InferModel<typeof users, 'insert'>; // insert type
  // ...

  // init mysql2 Pool or Client
  const pool = mysql.createPool({
      host:'localhost', 
      user: 'root',
      database: 'test'
  });

  export const db = drizzle(pool);

  const result: User[] = await db.select().from(users);

  async function insertUser(user: NewUser): Promise<MySqlRawQueryResult> {
    return db.insert(users).values(user);
  }
  ```
  </Tab>
  <Tab>
  ```typescript copy
  import { sqliteTable, text, integer, uniqueIndex } from 'drizzle-orm/sqlite-core';

  export const countries = sqliteTable('countries', {
      id: integer('id').primaryKey(),
      name: text('name'),
    }, (countries) => ({
      nameIdx: uniqueIndex('nameIdx').on(countries.name),
    })
  );

  export const cities = sqliteTable('cities', {
    id: integer('id').primaryKey(),
    name: text('name'),
    countryId: integer('country_id').references(() => countries.id),
  })
  ```

  Database and table explicit entity types

  ```typescript copy
  import { InferModel, text, integer, sqliteTable } from 'drizzle-orm/sqlite-core';

  const users = sqliteTable('users', {
    id: integer('id').primaryKey(),
    fullName: text('full_name'),
    phone: text('phone'),
  })

  export type User = InferModel<typeof users> // return type when queried
  export type InsertUser = InferModel<typeof users, 'insert'> // insert type
  // ...

  import { drizzle, BetterSQLite3Database } from 'drizzle-orm/better-sqlite3';
  import Database from 'better-sqlite3';

  const sqlite = new Database('sqlite.db');
  const db: BetterSQLite3Database = drizzle(sqlite);

  const result: User[] = db.select().from(users).all();

  const insertUser = (user: InsertUser) => {
    return db.insert(users).values(user).run()
  }
  ```
  </Tab>
</Tabs>
